version: 2

models:
  - name: candles_daily
    description: "Daily stock data enriched with derivate indicators like rolling avgs, returns, volatility..."
    columns:
      - name: year
        description: "Year extracted from the date (for partitioning)"
        data_type: integer
        tests:
          - not_null
      - name: month
        description: "Month extracted from the date (for partitioning)"
        data_type: integer
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
      - name: timeframe
        description: "Reference date"
        data_type: date
        tests:
          - not_null
      - name: symbol
        description: "Stock ticker symbol (e.g., AAPL, TSLA)."
        data_type: string
        tests:
          - not_null
      - name: open
        description: "Opening price of the day."
        data_type: float
      - name: close
        description: "Closing price of the day."
        data_type: float
      - name: high
        description: "Highest price of the day."
        data_type: float
      - name: low
        description: "Lowest price of the day."
        data_type: float
      - name: volume
        description: "Trading volume of the day."
        data_type: bigint

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: ["symbol", "timeframe"]

  - name: stock_daily_duck
    description: "Daily stock asset price&fundamentals data indicators. This is the blending that feeds the output dataset for stocks"
    columns:
      - name: timeframe
        description: "Reference date"
        data_type: date
        tests:
          - not_null
      - name: symbol
        description: "Stock ticker symbol (e.g., AAPL, TSLA)."
        data_type: string
        tests:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: ["symbol", "timeframe"]

  - name: sec_facts_schema
    description: "Company facts source from the SEC containing fundamental data for companies"
    columns:
      - name: top_level_field
        description: "Top level field in the `facts` JSON key"
        tests:
          - not_null
      - name: attribute_name
        description: "Name of the attribute as provided in the SEC data model"
        tests:
          - not_null
          - unique
      - name: label
        description: "Label provided in the SEC data model"
        tests:
          - not_null
      - name: description
        description: "Description of the attribute as provided in the SEC data model"
        tests:
          - not_null
